name: NodeJs GitHub Action

on: push

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Use Node.js

      uses: actions/setup-node@v3
      with:
        node-version: 20
    - name: Install dependencies
      run: npm install
    - name: Run test
      run: npm test

  deploy:
    runs-on: ubuntu-latest
    needs: [build]

    steps:
    - uses: actions/checkout@v3
    - name: Install Render CLI
      run: curl -fsSL https://cli.render.com/install.sh | sh
    - name: Verify Render CLI Installation
      run: render --version
    - name: Deploy to Render
      run: render deploy --service ${{ secrets.RENDER_SERVICE_NAME }} --token ${{ secrets.RENDER_TOKEN }}
      env:
        RENDER_TOKEN: ${{ secrets.RENDER_TOKEN }}
